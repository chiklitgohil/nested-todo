{% macro render_task(task) %}
<li style="--depth: {{ loop.depth0 }}">
    <div class="task-row">
        <button type="button" class="collapse-btn" onclick="toggleSubtasks({{ task.id }})">â–¼</button>

        <form action="/toggle/{{ task.id }}" method="get" class="inline">
            <input type="checkbox" onchange="this.form.submit()" {% if task.is_done %}checked{% endif %}>
        </form>

        <span class="{% if task.is_done %}done{% endif %}" id="title-{{ task.id }}">{{ task.title }}</span>

        <form action="/edit/{{ task.id }}" method="post" class="inline" id="edit-form-{{ task.id }}" style="display:none;">
            <input type="text" name="new_title" value="{{ task.title }}">
            <button type="submit">Save</button>
        </form>

        <button type="button" class="edit-btn" onclick="showEditForm({{ task.id }})">âœï¸</button>
        <a href="/delete/{{ task.id }}" class="delete-btn">ğŸ—‘ï¸</a>

        <form action="/add" method="post" class="inline add-subtask">
            <input type="hidden" name="parent_id" value="{{ task.id }}">
            <input type="text" name="title" placeholder="+ Add subtask">
        </form>
    </div>

    {% if task.children and task.children|length > 0 %}
        <ul id="children-{{ task.id }}">
            {% for child in task.children %}
                {{ render_task(child) }}
            {% endfor %}
        </ul>
    {% endif %}
</li>
{% endmacro %}
