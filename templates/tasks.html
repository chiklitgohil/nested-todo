{% macro render_task(task) %}
<li>
    <form action="/toggle/{{ task.id }}" method="get" style="display:inline;">
        <input type="checkbox" onchange="this.form.submit()" {% if task.is_done %}checked{% endif %}>
    </form>

    <span class="{% if task.is_done %}done{% endif %}" id="title-{{ task.id }}">{{ task.title }}</span>

    <!-- Edit form (hidden by default) -->
    <form action="/edit/{{ task.id }}" method="post" class="inline-form" id="edit-form-{{ task.id }}" style="display:none;">
        <input type="text" name="new_title" value="{{ task.title }}">
        <button type="submit">Save</button>
    </form>

    <button type="button" onclick="showEditForm({{ task.id }})">Edit</button>

    <form action="/add" method="post" class="inline-form">
        <input type="hidden" name="parent_id" value="{{ task.id }}">
        <input type="text" name="title" placeholder="Add subtask">
    </form>

    <a href="/delete/{{ task.id }}">Delete</a>

    {% if task.children and task.children|length > 0 %}
        <ul>
            {% for child in task.children %}
                {{ render_task(child) }}
            {% endfor %}
        </ul>
    {% endif %}
</li>
{% endmacro %}
