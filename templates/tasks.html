{# templates/tasks.html #}
{% macro render_task(task, depth=0) %}
<li class="list-group-item border-0 ps-{{ depth + 3 }} position-relative">

  {% if depth > 0 %}
  <div class="connector-line"></div>
  {% endif %}

  <div class="d-flex align-items-center justify-content-between task-item">
    <div class="d-flex align-items-center gap-2 flex-grow-1">
      <i class="fa-solid fa-grip-vertical text-secondary small"></i>

      <form action="/toggle/{{ task.id }}" method="get" style="display:inline;">
        <input type="checkbox" onchange="this.form.submit()" {% if task.is_done %}checked{% endif %}>
      </form>

      <span class="task-title flex-grow-1 {% if task.is_done %}text-decoration-line-through text-muted{% endif %}"
            id="task-title-{{ task.id }}"
            onclick="enableEdit({{ task.id }})">{{ task.title }}</span>

      <input type="text" class="form-control form-control-sm d-none"
             id="task-input-{{ task.id }}" value="{{ task.title }}"
             onblur="saveEdit({{ task.id }})" onkeydown="handleKey(event, {{ task.id }})">
    </div>

    <div class="task-actions opacity-0 d-flex align-items-center gap-2">
      <button type="button" class="btn btn-sm btn-outline-success p-1"
              onclick="showAddSubtask({{ task.id }})">
        <i class="fa-solid fa-plus"></i>
      </button>
      <a href="/delete/{{ task.id }}" class="btn btn-sm btn-outline-danger p-1">
        <i class="fa-solid fa-trash"></i>
      </a>
    </div>
  </div>

  {% if task.children and task.children|length > 0 %}
  <ul class="list-group border-0 ms-4 mt-2">
      {% for child in task.children %}
          {{ render_task(child, depth + 1) }}
      {% endfor %}
  </ul>
  {% endif %}
</li>
{% endmacro %}
